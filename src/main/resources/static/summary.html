<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>



<h1>Summary</h1>
<label>Project Name</label>:<label id="projectName1"></label>
<br/>
<label>Commit Count</label>:<label id="commitCount1"></label>
<br/>
<label>Issue Count</label>:<label id="issueCount1"></label>
<br/>
<label>Smell Count</label>:<label id="smellCount1"></label>
<br/>
<label>Pull Request Count</label>:<label id="pullRequestCount1"></label>
<br/>

<div width="1200" height="1200">
    <canvas id="developers1"></canvas>
</div>
<br/><br/>

<label>Project Name</label>:<label id="projectName2"></label>
<br/>
<label>Commit Count</label>:<label id="commitCount2"></label>
<br/>
<label>Issue Count</label>:<label id="issueCount2"></label>
<br/>
<label>Smell Count</label>:<label id="smellCount2"></label>
<br/>
<label>Pull Request Count</label>:<label id="pullRequestCount2"></label>
<br/>

<div width="1200" height="1200">
    <canvas id="developers2"></canvas>
</div>
<script src="script.js"></script>

</body>
<script>
    let project1 = {},
        project2 = {};

    const ctx1 = document.getElementById("developers1").getContext('2d'),
          ctx2 = document.getElementById("developers2").getContext('2d');

    const options = {
        responsive: true, // Instruct chart js to respond nicely.
        maintainAspectRatio: false, // Add to prevent default behaviour of full-width/height
        scales: {
            xAxes: [{ scaleLabel: { display: true, labelString: 'followers' } }],
            yAxes: [{ scaleLabel: { display: true, labelString: 'actions' } }]
        }
    };

    $.getJSON('http://localhost:8080/github/summary', function(data) {
        // JSON result in `data` variable
        project1 = data[0];
        project2 = data[1];

        project1.developersData = prepareDeveloperData(project1);
        project2.developersData = prepareDeveloperData(project2);

        setProjectInfo(1, project1, ctx1);
        setProjectInfo(2, project2, ctx2);
    });

    function setProjectInfo(order, project, ctx){
        $('#projectName' + order).text(project.projectName);
        $('#commitCount' + order).text(project.commitCount);
        $('#issueCount' + order).text(project.issueCount);
        $('#smellCount' + order).text(project.smellCount);
        $('#pullRequestCount' + order).text(project.pullRequestCount);

        drawGraph(project, ctx);
    }

    function prepareDeveloperData(projectSummary){
        const data = [];
        $.each(projectSummary.developers, function( index, value ) {
            data.push({x: value.experience, y: value.activityCount})
        });
        return data;
    }

    function drawGraph(data, chart){
        var myChart = new Chart(chart, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: data.projectName, // Name the series
                    data: data.developersData, // Specify the data values array
                    borderColor: '#2196f3', // Add custom color border
                    backgroundColor: '#2196f3', // Add custom color background (Points and Fill)
                }
                ]
            },
            options: options
        });
    }

</script>
</html>